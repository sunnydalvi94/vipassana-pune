<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Login extends Base_Controller {

	/*
	-------------------------------------------------------------
	Author 	: Roshan Deshmukh				Date: 18 Dec 19
	-------------------------------------------------------------
	*/

	public function __construct()
  	{
	    parent::__construct(); 
    }

	public function index()
    {
        if($this->authentication->chk_login())
        {
            redirect('dashboard');
        }
        else
        {
            $this->load->view('login');
        }
    }

	public function chk_login() 
    {
        $username=$this->input->post('username');
        $password=$this->input->post('password');

        $chklogin = false;
        if (!isset($username) or strlen($username) == 0)
        {
            $error = 'Please enter your username.';
        }
        elseif (!isset($password) or strlen($password) == 0)
        {
            $error = 'Please enter your password.';
        }
        else
        {
            $chklogin=$this->authentication->login($username,$password);
            if(!$chklogin) $error = 'Wrong username / password, please try again.';
        }

        $ajax = (isset($_SERVER['HTTP_X_REQUESTED_WITH']) and strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest');
        if($chklogin && $ajax)
        {  
            $data=array(
                'valid' => TRUE,
                'redirect' => base_url().'dashboard'
            );
        }
        else
        {
            $data=array(
                'valid' => FALSE,
                'msg' => $error
            );
        }
        $this->json->jsonReturn($data);
    }	
    
    public function logout()
    {
        $this->authentication->logout();
        redirect('login');
    }
}
